{% extends 'base.html' %}
{% load static %}

{% block title %}Tableau de bord administrateur - CarWash Pro{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
                Tableau de bord administrateur
            </h1>
            <div class="flex space-x-4">
                <span class="text-sm bg-gray-800 px-4 py-2 rounded-full border border-gray-700">
                    <span class="animate-pulse inline-block h-2 w-2 mr-2 rounded-full bg-green-500"></span>
                    En ligne
                </span>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Total Appointments -->
            <div class="transform hover:scale-105 transition-transform duration-300">
                <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-blue-600 to-blue-800 p-6 backdrop-blur-lg border border-blue-700/50">
                    <div class="absolute -right-6 -top-6 w-24 h-24 bg-blue-500/20 rounded-full blur-2xl"></div>
                    <h3 class="text-lg font-semibold text-blue-100 mb-1">Total Rendez-vous</h3>
                    <p class="text-3xl font-bold text-white">{{ total_appointments }}</p>
                    <div class="mt-4 flex items-center text-blue-200 text-sm">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm0-2a6 6 0 100-12 6 6 0 000 12z" clip-rule="evenodd"/>
                        </svg>
                        Mise à jour en temps réel
                    </div>
                </div>
            </div>

            <!-- Revenue -->
            <div class="transform hover:scale-105 transition-transform duration-300">
                <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-emerald-600 to-emerald-800 p-6 backdrop-blur-lg border border-emerald-700/50">
                    <div class="absolute -right-6 -top-6 w-24 h-24 bg-emerald-500/20 rounded-full blur-2xl"></div>
                    <h3 class="text-lg font-semibold text-emerald-100 mb-1">Chiffre d'affaires</h3>
                    <p class="text-3xl font-bold text-white">{{ total_revenue }} €</p>
                    <div class="mt-4 flex items-center text-emerald-200 text-sm">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
                        </svg>
                        Croissance positive
                    </div>
                </div>
            </div>

            <!-- Employees -->
            <div class="transform hover:scale-105 transition-transform duration-300">
                <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-purple-600 to-purple-800 p-6 backdrop-blur-lg border border-purple-700/50">
                    <div class="absolute -right-6 -top-6 w-24 h-24 bg-purple-500/20 rounded-full blur-2xl"></div>
                    <h3 class="text-lg font-semibold text-purple-100 mb-1">Employés</h3>
                    <p class="text-3xl font-bold text-white">{{ total_employees }}</p>
                    <div class="mt-4 flex items-center text-purple-200 text-sm">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                        </svg>
                        Équipe active
                    </div>
                </div>
            </div>

            <!-- Clients -->
            <div class="transform hover:scale-105 transition-transform duration-300">
                <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-amber-600 to-amber-800 p-6 backdrop-blur-lg border border-amber-700/50">
                    <div class="absolute -right-6 -top-6 w-24 h-24 bg-amber-500/20 rounded-full blur-2xl"></div>
                    <h3 class="text-lg font-semibold text-amber-100 mb-1">Clients</h3>
                    <p class="text-3xl font-bold text-white">{{ total_clients }}</p>
                    <div class="mt-4 flex items-center text-amber-200 text-sm">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                        </svg>
                        Base clients fidèle
                    </div>
                </div>
            </div>
        </div>

        <!-- Today's Appointments -->
        <div class="bg-gray-800/50 rounded-2xl backdrop-blur-xl border border-gray-700/50 p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold text-white">Rendez-vous du jour</h2>
                <span class="px-3 py-1 text-xs rounded-full bg-blue-500/20 text-blue-300 border border-blue-500/30">
                    Aujourd'hui
                </span>
            </div>
            {% if today_appointments %}
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-left border-b border-gray-700">
                            <th class="pb-3 text-sm font-medium text-gray-400">Heure</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Client</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Service</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Véhicule</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Employé</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Statut</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for appointment in today_appointments %}
                        <tr class="border-b border-gray-800 hover:bg-gray-800/30 transition-colors">
                            <td class="py-4 text-sm">{{ appointment.appointment_date|date:"H:i" }}</td>
                            <td class="py-4 text-sm">{{ appointment.client.get_full_name }}</td>
                            <td class="py-4 text-sm">{{ appointment.service.name }}</td>
                            <td class="py-4 text-sm">{{ appointment.vehicle.brand }} {{ appointment.vehicle.model }}</td>
                            <td class="py-4 text-sm">
                                {% if not appointment.employee %}
                                <a href="{% url 'assign_employee_to_appointment' appointment.id %}" 
                                   class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-500/20 text-blue-300 hover:bg-blue-500/30 transition-colors">
                                    Assigner
                                </a>
                                {% else %}
                                    {{ appointment.employee.get_full_name }}
                                {% endif %}
                            </td>
                            <td class="py-4 text-sm">
                                <span class="px-3 py-1 rounded-full text-xs font-medium 
                                    {% if appointment.status == 'pending' %}bg-amber-500/20 text-amber-300 border border-amber-500/30
                                    {% elif appointment.status == 'confirmed' %}bg-blue-500/20 text-blue-300 border border-blue-500/30
                                    {% elif appointment.status == 'completed' %}bg-emerald-500/20 text-emerald-300 border border-emerald-500/30
                                    {% elif appointment.status == 'cancelled' %}bg-red-500/20 text-red-300 border border-red-500/30
                                    {% endif %}">
                                    {{ appointment.get_status_display }}
                                </span>
                            </td>
                            <td class="py-4 text-sm">
                                <a href="{% url 'appointment_detail' appointment.id %}" 
                                   class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-700 hover:bg-gray-600 transition-colors">
                                    Détails
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-8 text-gray-400">
                <svg class="mx-auto h-12 w-12 mb-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <p>Aucun rendez-vous aujourd'hui.</p>
            </div>
            {% endif %}
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <!-- Popular Services -->
            <div class="bg-gray-800/50 rounded-2xl backdrop-blur-xl border border-gray-700/50 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-white">Services les plus demandés</h2>
                    <span class="px-3 py-1 text-xs rounded-full bg-purple-500/20 text-purple-300 border border-purple-500/30">
                        Top services
                    </span>
                </div>
                {% if popular_services %}
                <div class="space-y-4">
                    {% for service in popular_services %}
                    <div class="flex items-center justify-between p-4 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 transition-colors">
                        <div>
                            <h3 class="font-medium text-white">{{ service.name }}</h3>
                            <p class="text-sm text-gray-400">{{ service.appointment_count }} rendez-vous</p>
                        </div>
                        <span class="text-emerald-400 font-semibold">{{ service.price }} €</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 text-gray-400">
                    <p>Aucun service n'a été réservé.</p>
                </div>
                {% endif %}
            </div>

            <!-- Appointment Stats -->
            <div class="bg-gray-800/50 rounded-2xl backdrop-blur-xl border border-gray-700/50 p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-white">Statistiques des rendez-vous</h2>
                    <span class="px-3 py-1 text-xs rounded-full bg-emerald-500/20 text-emerald-300 border border-emerald-500/30">
                        En temps réel
                    </span>
                </div>
                {% if appointment_stats %}
                <div class="space-y-4">
                    {% for stat in appointment_stats %}
                    <div class="flex items-center justify-between p-4 rounded-xl bg-gray-700/30 hover:bg-gray-700/50 transition-colors">
                        <span class="px-3 py-1 rounded-full text-xs font-medium 
                            {% if stat.status == 'pending' %}bg-amber-500/20 text-amber-300 border border-amber-500/30
                            {% elif stat.status == 'confirmed' %}bg-blue-500/20 text-blue-300 border border-blue-500/30
                            {% elif stat.status == 'completed' %}bg-emerald-500/20 text-emerald-300 border border-emerald-500/30
                            {% elif stat.status == 'cancelled' %}bg-red-500/20 text-red-300 border border-red-500/30
                            {% endif %}">
                            {{ stat.status|title }}
                        </span>
                        <span class="font-semibold text-white">{{ stat.count }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-8 text-gray-400">
                    <p>Aucune statistique disponible.</p>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Upcoming Appointments -->
        <div class="bg-gray-800/50 rounded-2xl backdrop-blur-xl border border-gray-700/50 p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold text-white">Rendez-vous à venir</h2>
                <span class="px-3 py-1 text-xs rounded-full bg-amber-500/20 text-amber-300 border border-amber-500/30">
                    Prochains jours
                </span>
            </div>
            {% if upcoming_appointments %}
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="text-left border-b border-gray-700">
                            <th class="pb-3 text-sm font-medium text-gray-400">Date</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Heure</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Client</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Service</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Employé</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Statut</th>
                            <th class="pb-3 text-sm font-medium text-gray-400">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for appointment in upcoming_appointments %}
                        <tr class="border-b border-gray-800 hover:bg-gray-800/30 transition-colors">
                            <td class="py-4 text-sm">{{ appointment.appointment_date|date:"d/m/Y" }}</td>
                            <td class="py-4 text-sm">{{ appointment.appointment_date|date:"H:i" }}</td>
                            <td class="py-4 text-sm">{{ appointment.client.get_full_name }}</td>
                            <td class="py-4 text-sm">{{ appointment.service.name }}</td>
                            <td class="py-4 text-sm">{{ appointment.employee.get_full_name|default:"Non assigné" }}</td>
                            <td class="py-4 text-sm">
                                <span class="px-3 py-1 rounded-full text-xs font-medium 
                                    {% if appointment.status == 'pending' %}bg-amber-500/20 text-amber-300 border border-amber-500/30
                                    {% elif appointment.status == 'confirmed' %}bg-blue-500/20 text-blue-300 border border-blue-500/30
                                    {% elif appointment.status == 'completed' %}bg-emerald-500/20 text-emerald-300 border border-emerald-500/30
                                    {% elif appointment.status == 'cancelled' %}bg-red-500/20 text-red-300 border border-red-500/30
                                    {% endif %}">
                                    {{ appointment.get_status_display }}
                                </span>
                            </td>
                            <td class="py-4 text-sm">
                                <a href="{% url 'appointment_detail' appointment.id %}" 
                                   class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-700 hover:bg-gray-600 transition-colors">
                                    Détails
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-8 text-gray-400">
                <svg class="mx-auto h-12 w-12 mb-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <p>Aucun rendez-vous à venir.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %} 